<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dsbath.admin.model.mapper.TileCodeMapper">

<!--============== 타일 코드 목록 START ==============-->
	<select id="select" parameterType="com.dsbath.admin.model.dto.PagingDTO" resultType="tileCode">
		SELECT
			TileCodeIdx,
			Image,
			TileName,
			TileCode,
			CreateDate,
			UpdateDate
			
		  FROM TileCode
		  
		<!-- 공통 조건 -->
		<include refid="selectOfWhere"></include>
		 
		<!-- order -->
		<choose>
			<when test='@com.dsbath.admin.etc.util.StringUtil@isNotEmpty(sort) and @com.dsbath.admin.etc.util.StringUtil@isNotEmpty(sortType)'>
				ORDER BY 
		 	
				<choose>
				 	<when test='"tileName".equals(sortType)'>
				 		TileName
					</when>
				 	<when test='"createDate".equals(sortType)'>
				 		CreateDat
					</when>
				 	<when test='"updateDate".equals(sortType)'>
				 		UpdateDate
					</when>
				</choose>
				 
				<choose>
					<when test='"asc".equals(sort)'>
						ASC
					</when>
					<when test='"desc".equals(sort)'>
						DESC
					</when>
				</choose>
			</when>
			
			<otherwise>
				ORDER BY CreateDate DESC
			</otherwise>
		</choose>
		
		  <!-- paging -->
		  LIMIT #{page}, #{limit}
	</select>
<!--============== 타일 코드 목록 END ==============-->


<!--============== 타일 코드 목록 Total Count START ==============-->
	<select id="selectOfTotalCount" parameterType="com.dsbath.admin.model.dto.PagingDTO" resultType="long">
		SELECT COUNT(TileCodeIdx)
		  FROM TileCode
		  
		<!-- 공통 조건 -->
		<include refid="selectOfWhere"></include>
	</select>
<!--============== 타일 코드 목록 Total Count END ==============-->


<!--============== 타일 코드 등록 START ==============-->
	<insert id="insert" parameterType="tileCode">
		INSERT INTO TileCode
		(
			Image,
			TileName
		)
		VALUES
		(
			#{image},
			#{tileName}
		)
	</insert>
<!--============== 타일 코드 등록 END ==============-->


<!--============== 타일 코드 수정 START ==============-->
	<update id="update" parameterType="tileCode">
		UPDATE TileCode
		   SET
		   
		   	Image 		= #{image},
		   	tileName	= #{tileName},
		   	tileCode	= #{tileCode}
		   	
		 WHERE TileCodeIdx = #{tileCodeIdx} 
	</update>
<!--============== 타일 코드 수정 END ==============-->


<!--============== 타일 코드 삭제 START ==============-->
	<delete id="delete" parameterType="tileCode">
		DELETE FROM TileCode
		 WHERE TileCodeIdx = #{tileCodeIdx}
	</delete>	
<!--============== 타일 코드 삭제 END ==============-->


<!--============== 목록 조회 공통 조건 START ==============-->
	<sql id="selectOfWhere">
		
		<where>
			<if test='@com.dsbath.admin.etc.util.StringUtil@isNotEmpty(model.tileName)'>
		 		<!-- 코드 명 -->
		 		AND TileName LIKE CONCAT('%', TRIM(#{model.tileName}), '%')
		 	</if>
		 	
		 	<if test='@com.dsbath.admin.etc.util.StringUtil@isNotEmpty(startDateStr) and @com.dsbath.admin.etc.util.StringUtil@isNotEmpty(endDateStr)'>
		 		<!-- 등록일 -->
		 		AND DATE_FORMAT(CreateDate, '%Y%m%d') BETWEEN #{startDateStr} AND #{endDateStr}
		 	</if>
		</where>
		
	</sql>
<!--============== 목록 조회 공통 조건 END ==============-->
</mapper>